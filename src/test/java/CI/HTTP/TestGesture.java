package CI.HTTP;

import de.kosmos_lab.web.server.WebServer;
import de.kosmos_lab.utils.StringFunctions;
import org.eclipse.jetty.client.api.ContentResponse;
import org.eclipse.jetty.http.HttpMethod;
import org.json.JSONArray;
import org.json.JSONObject;
import org.testng.Assert;
import org.testng.annotations.Test;

import java.io.File;

import static common.CommonBase.clientAdmin;
import static common.CommonBase.controller;

public class TestGesture {
    @Test(groups = "testGesture", dependsOnGroups = {"login"})
    public void testGesture() {
        ContentResponse response = clientAdmin.getResponse("/gesture/list", HttpMethod.GET);
        Assert.assertNotNull(response);
        Assert.assertEquals(response.getStatus(), WebServer.STATUS_OK);
        JSONArray arr = new JSONArray(response.getContentAsString());
        Assert.assertEquals(arr.length(), 0);
        JSONObject object = new JSONObject();
        
        TGesture[] gests = new TGesture[]{
                new TGesture("T", "[[[478,41],[478,42],[478,43],[478,45],[478,46],[478,50],[479,54],[479,60],[479,67],[479,76],[479,85],[479,96],[479,106],[479,117],[478,127],[477,140],[477,151],[476,161],[475,170],[474,179],[473,186],[473,193],[472,199],[471,205],[470,210],[470,214],[468,219],[468,222],[468,225],[467,227],[467,229],[467,230],[467,231],[467,232],[467,233],[467,234],[467,235],[467,236],[467,237],[467,238],[467,239],[467,240],[467,241],[467,242],[467,243],[467,244],[467,245],[467,246],[467,247],[467,249],[467,252],[467,256],[467,259],[467,261],[467,264],[467,266],[467,268],[467,269],[467,271],[467,272],[467,273],[467,275],[467,276],[467,277],[467,278],[468,279],[468,280],[468,281],[468,282],[468,283],[468,284],[468,285],[468,286],[468,288],[469,289],[469,291],[469,292],[469,293],[469,294],[470,295],[470,296],[470,297],[470,298],[470,299],[470,300]],[[461,154],[460,154],[459,154],[458,154],[456,154],[453,154],[450,154],[447,154],[443,154],[439,154],[434,155],[429,155],[424,156],[418,156],[412,156],[406,157],[400,157],[395,157],[390,157],[386,157],[381,157],[377,157],[372,157],[368,157],[363,157],[359,157],[355,157],[350,157],[345,157],[341,157],[337,156],[333,156],[328,156],[325,156],[322,155],[318,155],[314,154],[311,154],[309,154],[306,154],[304,154],[302,153],[300,153],[298,153],[295,153],[293,153],[291,153],[289,152],[286,152],[284,152],[281,152],[278,152],[276,152],[274,152],[272,151],[269,151],[267,151],[264,151],[262,151],[261,151],[259,151],[258,151],[256,151],[255,151],[253,151],[251,151],[249,151],[247,151],[244,151],[241,151],[239,151],[237,152],[235,152],[233,152],[231,152],[229,152],[228,153],[226,153],[225,153],[223,153],[222,153],[221,153],[220,153],[218,153],[217,153],[215,153],[214,153],[212,153],[210,153],[208,153],[207,153],[205,153],[203,153],[202,153],[201,153],[200,153],[198,153],[197,153],[196,153],[195,153],[194,153],[193,153],[191,153],[190,153],[189,153],[179,152],[178,152],[177,152],[175,152],[174,151],[173,150],[171,150],[170,150],[169,150],[167,149],[166,149],[165,149],[163,149],[162,149],[161,149],[160,149],[159,149],[158,149],[157,149],[156,149],[155,149],[154,149],[153,149],[152,149],[151,149],[150,149],[149,149],[148,149],[147,149],[146,149],[145,149],[144,149],[143,149],[142,149],[141,149],[140,149],[139,149],[139,150]]]"),
                new TGesture("T", "[[[475,315],[475,314],[475,313],[475,312],[475,310],[475,306],[476,303],[476,299],[477,294],[477,289],[478,284],[479,279],[479,274],[480,269],[481,264],[482,259],[482,254],[483,250],[483,246],[484,241],[485,236],[486,231],[486,227],[487,221],[488,217],[488,213],[488,208],[489,204],[489,201],[489,198],[489,195],[489,192],[489,189],[489,187],[489,183],[489,180],[489,176],[489,172],[489,169],[489,164],[489,161],[488,157],[488,155],[487,152],[487,148],[486,146],[486,143],[485,140],[485,138],[485,135],[484,132],[483,130],[483,128],[482,126],[482,124],[481,122],[481,120],[481,119],[481,118],[480,116],[479,115],[479,114],[479,113],[479,112],[479,111],[478,110],[478,109],[478,108],[478,107],[478,106],[477,106],[477,105],[477,104],[477,103],[477,102],[477,101],[477,100],[477,99],[477,98],[477,97],[477,96],[477,95],[477,94],[477,93],[477,92],[477,91],[477,90],[477,89]],[[449,181],[446,180],[444,180],[441,179],[436,178],[433,177],[428,176],[424,176],[419,176],[414,175],[409,174],[403,174],[396,174],[391,174],[385,174],[379,174],[373,175],[367,175],[361,176],[355,176],[349,177],[344,178],[337,178],[332,178],[327,178],[322,178],[318,178],[313,178],[310,178],[307,178],[302,177],[300,177],[296,176],[292,176],[289,175],[286,175],[283,174],[280,174],[277,174],[274,174],[271,173],[268,173],[265,173],[262,173],[259,173],[256,172],[254,172],[251,172],[250,172],[247,171],[246,171],[244,171],[242,170],[240,170],[238,170],[236,170],[235,170],[233,170],[231,169],[229,169],[227,169],[226,169],[223,169],[222,169],[220,169],[218,169],[217,169],[215,169],[213,169],[212,169],[210,169],[209,169],[207,169],[206,169],[205,168],[204,168],[203,168],[202,168],[201,168],[200,168],[199,168],[198,168]]]"),
                new TGesture("O", "[[[433,238],[433,237],[434,235],[434,231],[435,227],[435,221],[435,215],[436,208],[437,200],[437,191],[437,183],[437,173],[437,164],[437,155],[437,146],[436,138],[435,128],[434,120],[432,112],[429,105],[427,97],[424,90],[419,83],[416,76],[412,72],[408,67],[405,63],[403,59],[400,56],[397,53],[394,50],[392,48],[389,45],[386,43],[382,40],[380,38],[377,36],[373,33],[370,32],[366,30],[363,28],[360,27],[355,26],[351,25],[347,25],[343,25],[340,25],[336,25],[332,25],[329,25],[326,25],[322,26],[318,27],[315,29],[311,30],[307,33],[303,35],[300,38],[296,41],[292,44],[287,48],[283,51],[279,55],[275,60],[270,63],[266,67],[262,71],[258,75],[254,79],[249,84],[245,89],[240,94],[236,100],[231,106],[227,112],[223,116],[219,122],[216,127],[213,132],[209,137],[207,141],[205,145],[204,150],[203,154],[201,158],[201,163],[200,167],[200,171],[200,175],[200,179],[202,183],[204,187],[206,192],[208,196],[211,200],[213,204],[217,210],[220,214],[223,218],[226,221],[229,226],[233,229],[237,232],[241,235],[246,238],[252,240],[257,242],[264,243],[270,244],[276,245],[282,245],[288,245],[294,245],[300,245],[305,245],[309,245],[315,245],[319,245],[323,245],[327,245],[331,245],[334,245],[337,245],[341,245],[344,244],[348,244],[352,243],[355,243],[358,242],[361,242],[364,241],[368,241],[370,241],[373,240],[377,240],[379,240],[382,240],[384,240],[386,240],[388,240],[390,240],[393,240],[394,241],[396,241],[398,241],[399,241],[400,241],[401,241],[402,241],[404,241],[405,241],[406,241],[407,241],[408,241],[409,241],[410,241],[412,241],[413,241],[413,240],[414,240],[415,239],[416,239],[417,239],[418,239],[419,239],[420,239],[421,239],[423,239],[424,238],[426,238],[427,238],[428,238],[429,238],[431,238],[432,237],[434,237],[435,237],[436,236],[437,235],[438,235],[439,235],[439,234],[440,234]]]"),
                new TGesture("O", "[[[412,233],[413,232],[414,232],[414,231],[415,230],[415,229],[416,227],[418,225],[419,221],[421,217],[423,213],[425,207],[426,201],[426,196],[427,191],[427,186],[427,180],[427,174],[427,168],[426,163],[424,156],[423,150],[421,143],[418,136],[416,131],[414,126],[411,121],[408,117],[404,113],[402,109],[398,104],[394,100],[390,96],[386,93],[381,90],[376,87],[372,84],[367,83],[362,81],[357,79],[351,78],[346,76],[339,74],[333,73],[328,71],[323,70],[316,69],[309,67],[304,66],[298,65],[291,63],[285,63],[280,63],[273,63],[268,63],[263,63],[258,64],[253,64],[248,65],[244,66],[239,68],[234,69],[229,71],[224,74],[219,77],[215,79],[210,82],[206,85],[203,88],[200,91],[197,95],[195,98],[192,102],[191,105],[188,108],[186,114],[185,118],[183,122],[181,126],[179,131],[178,136],[176,142],[174,149],[173,155],[171,163],[171,170],[170,175],[169,181],[169,186],[169,191],[169,196],[169,200],[169,204],[170,208],[170,212],[172,216],[173,219],[175,222],[177,226],[179,228],[182,232],[184,236],[189,240],[193,245],[198,249],[203,254],[209,258],[214,261],[219,264],[225,267],[231,270],[237,273],[243,275],[249,277],[255,280],[260,281],[267,283],[272,284],[278,284],[284,285],[290,285],[296,285],[302,285],[308,285],[314,285],[319,284],[324,283],[329,281],[333,279],[337,278],[341,277],[345,275],[347,273],[351,272],[354,271],[356,269],[360,268],[363,267],[366,266],[368,265],[371,263],[374,262],[376,261],[378,260],[380,259],[382,258],[384,257],[385,256],[386,255],[387,255],[388,254],[389,253],[390,253],[391,251],[393,250],[394,250],[396,249],[397,248],[399,246],[400,245],[402,245],[403,244],[405,242],[407,241],[408,240],[409,239],[411,238],[412,237],[413,236],[413,235],[414,234],[415,234],[415,233],[416,233],[416,232],[417,232],[417,231],[417,230],[418,230],[418,229],[418,228]]]"),
                new TGesture("X", "[[[368,70],[367,70],[366,71],[365,73],[362,76],[357,81],[353,85],[348,89],[343,93],[339,97],[334,102],[330,105],[325,108],[321,111],[317,115],[313,119],[309,122],[305,126],[300,130],[295,135],[290,139],[284,145],[279,150],[273,155],[268,160],[261,165],[254,171],[248,176],[242,181],[235,186],[229,192],[224,196],[219,200],[214,204],[210,209],[206,213],[202,217],[199,220],[196,224],[193,227],[190,230],[186,234],[183,238],[180,241],[177,245],[174,248],[171,251],[169,254],[166,256],[165,259],[163,260],[162,261],[160,263],[159,264],[158,265],[157,266],[156,267],[155,268],[154,268],[153,269],[153,270],[152,270],[152,271],[151,271],[151,270]],[[170,101],[171,101],[172,101],[175,103],[179,105],[184,108],[189,112],[196,117],[205,122],[213,129],[222,136],[235,145],[245,152],[254,159],[263,167],[271,174],[279,181],[287,187],[294,194],[303,201],[307,204],[314,209],[320,213],[325,217],[330,221],[335,224],[338,226],[342,229],[345,232],[348,233],[350,235],[352,237],[354,238],[356,240],[357,241],[357,242],[358,242],[358,243],[359,244],[359,245],[360,245],[361,246],[361,247]]]"),
                new TGesture("X", "[[[424,128],[423,128],[420,128],[417,128],[411,130],[405,131],[399,133],[391,135],[383,139],[375,143],[365,148],[355,155],[345,161],[336,167],[327,174],[319,180],[310,187],[302,194],[294,201],[287,208],[280,216],[272,222],[265,231],[259,237],[254,243],[249,248],[245,252],[241,257],[237,262],[234,266],[231,269],[228,273],[226,276],[224,278],[221,280],[219,282],[217,285],[216,286],[213,288],[212,290],[210,291],[209,292],[207,293],[206,294],[204,295],[202,296],[200,297],[199,298],[197,298],[195,299],[192,300],[191,301],[189,302],[187,302],[186,303],[185,303],[185,304],[184,304]],[[163,112],[164,112],[167,112],[170,112],[174,112],[179,114],[185,117],[191,119],[198,122],[206,126],[215,131],[225,137],[234,142],[245,150],[255,156],[266,164],[278,171],[290,179],[300,187],[310,194],[320,201],[328,207],[336,214],[343,220],[350,227],[355,232],[359,237],[362,241],[365,245],[368,248],[369,251],[372,254],[373,257],[374,260],[376,262],[377,265],[379,267],[380,269],[381,272],[382,274],[384,277],[385,279],[386,282],[388,285],[389,287],[389,289],[390,291],[391,293],[391,295],[392,296],[392,297],[392,298]]]"),
                new TGesture("sun", "[[[349,221],[349,220],[349,219],[349,218],[349,217],[349,216],[349,214],[349,213],[349,212],[349,210],[349,208],[349,206],[349,204],[349,200],[349,197],[349,194],[349,190],[349,186],[349,182],[349,178],[348,175],[347,171],[347,168],[347,165],[346,162],[346,159],[345,157],[345,155],[344,153],[344,152],[343,150],[342,149],[342,148],[342,147],[341,146],[341,145],[340,145],[339,145],[338,145],[337,145],[336,145],[335,145],[334,145],[333,145],[332,145],[331,145],[330,145],[329,146],[329,147],[328,147],[327,148],[326,149],[325,149],[324,151],[322,152],[321,153],[320,155],[318,157],[317,158],[316,160],[315,161],[314,163],[313,165],[312,166],[312,168],[311,170],[310,172],[310,173],[310,175],[310,176],[309,177],[309,178],[309,180],[309,181],[309,183],[309,185],[309,187],[309,189],[309,190],[309,193],[309,195],[309,197],[311,199],[311,201],[312,203],[312,204],[313,206],[314,207],[315,209],[316,210],[317,211],[317,213],[319,214],[320,215],[321,217],[322,218],[323,218],[329,223],[330,224],[331,225],[332,226],[333,227],[334,227],[334,228],[335,228],[336,228],[337,228],[337,229],[338,229],[339,229],[340,229],[340,228],[341,228],[341,227],[342,226],[343,225],[343,224],[344,224],[344,223],[345,223],[345,222],[345,221],[345,220],[345,219],[346,219],[346,218]],[[427,114],[427,115],[427,116],[425,117],[423,118],[420,119],[418,121],[414,123],[410,126],[406,128],[402,130],[396,134],[392,137],[389,139],[385,142],[382,144],[380,147],[378,149],[376,151],[374,153],[373,155],[372,157],[372,158],[371,160],[370,161],[370,162],[370,163],[370,164],[370,165],[370,166]],[[409,249],[407,249],[406,249],[404,248],[403,248],[400,246],[398,245],[396,243],[394,242],[392,240],[390,237],[388,235],[385,232],[383,228],[381,225],[379,222],[377,219],[376,216],[375,213],[374,212],[374,210],[373,209],[373,208]],[[258,263],[259,263],[260,263],[262,262],[265,260],[269,259],[273,258],[276,255],[282,253],[286,251],[289,248],[293,245],[297,243],[300,240],[304,237],[307,235],[309,232],[311,230],[313,228],[314,227],[315,226],[315,225],[316,224],[316,223]],[[242,155],[243,155],[245,154],[247,154],[249,154],[253,154],[257,154],[261,154],[265,155],[269,157],[273,159],[276,161],[280,163],[283,165],[287,167],[290,169],[292,171],[294,173],[297,175],[298,177],[299,178],[300,179],[301,179],[302,179]],[[317,104],[318,104],[319,106],[320,106],[320,108],[321,111],[323,114],[325,119],[327,125],[330,133],[333,141],[337,149],[340,157],[342,166],[345,173],[348,181],[349,187],[351,193],[353,198],[354,202],[355,206],[355,208],[355,209]]]"),
                new TGesture("sun", "[[[306,244],[307,244],[309,244],[310,244],[312,244],[313,244],[314,244],[315,244],[317,242],[318,241],[319,239],[320,237],[321,234],[323,231],[323,227],[325,223],[326,219],[327,214],[327,210],[327,205],[327,200],[327,196],[327,190],[327,185],[327,181],[327,177],[327,173],[326,170],[326,167],[324,165],[323,163],[323,160],[321,157],[320,156],[319,153],[317,152],[315,150],[313,148],[311,147],[309,145],[306,145],[303,144],[301,144],[298,144],[295,144],[291,144],[288,146],[284,148],[280,151],[276,154],[273,156],[269,159],[267,162],[264,164],[261,167],[259,171],[257,174],[255,176],[253,180],[252,183],[251,185],[251,188],[250,191],[249,193],[249,196],[249,198],[249,200],[249,203],[249,205],[249,208],[250,211],[251,214],[251,217],[252,220],[254,223],[255,226],[256,229],[258,232],[260,235],[262,237],[264,241],[266,243],[267,245],[269,247],[271,248],[273,250],[275,251],[277,252],[280,252],[282,252],[285,252],[288,252],[291,252],[293,252],[295,252],[297,252],[299,252],[301,251],[304,251],[305,250],[308,249],[309,248],[312,246],[314,245],[317,242],[318,241],[320,239],[321,237],[321,236],[321,235],[321,234],[321,233]],[[419,154],[418,153],[416,153],[413,152],[410,151],[407,151],[403,151],[398,151],[393,151],[388,151],[382,152],[377,155],[373,157],[369,159],[365,162],[362,165],[359,167],[357,170],[354,173],[351,176],[348,178],[346,181],[344,182],[342,184],[340,185],[339,186],[337,187],[337,188]],[[388,274],[387,274],[386,272],[385,271],[383,269],[382,267],[381,265],[379,263],[377,261],[376,259],[374,257],[373,255],[372,253],[370,251],[369,250],[367,247],[366,246],[365,244],[363,242],[362,241],[360,239],[358,237],[357,235],[356,234],[354,232],[353,230],[352,229],[350,228],[350,227],[349,226],[348,226]],[[274,296],[274,295],[274,294],[275,293],[276,292],[277,290],[279,287],[282,284],[284,281],[287,278],[289,275],[291,273],[294,271],[295,269],[296,268],[298,267],[299,266],[300,264],[301,263],[302,262],[303,261]],[[192,273],[192,272],[192,271],[192,270],[192,269],[193,267],[195,264],[197,262],[199,260],[201,258],[203,256],[206,254],[208,251],[211,250],[214,246],[217,244],[219,241],[222,239],[224,236],[226,234],[227,232],[229,231],[230,230],[231,228],[232,228],[232,227],[233,226],[233,225]],[[184,146],[185,146],[185,145],[187,145],[189,145],[193,145],[197,147],[202,148],[206,151],[210,153],[215,156],[219,158],[223,160],[226,162],[229,164],[232,166],[234,167],[236,168],[237,168],[239,170],[240,170],[241,170],[243,170],[244,170],[245,170],[245,171],[246,171],[247,171]],[[259,88],[260,88],[261,89],[263,91],[264,93],[266,97],[267,101],[270,106],[271,112],[274,118],[276,123],[278,129],[280,136],[281,141],[283,147],[284,151],[285,154],[285,157],[286,158],[286,159]],[[345,102],[344,102],[343,103],[342,105],[339,107],[338,109],[336,111],[334,114],[333,117],[331,120],[330,123],[329,126],[328,128],[327,131],[325,135],[324,138],[322,142],[321,145],[319,148],[318,151],[317,153],[315,155],[314,157],[313,158],[313,159],[312,159]]]"),
        };
        for (TGesture gest : gests) {
            object.put("name", gest.name);
            object.put("points", gest.points);
            response = clientAdmin.getResponse("/gesture/add", HttpMethod.POST, object);
            Assert.assertNotNull(response);
            Assert.assertEquals(response.getStatus(), WebServer.STATUS_OK);
            response = clientAdmin.getResponse("/gesture/guess", HttpMethod.POST, gest.points);
            Assert.assertNotNull(response);
            Assert.assertEquals(response.getStatus(), WebServer.STATUS_OK);
            JSONObject o = new JSONObject(response.getContentAsString());
            Assert.assertEquals(o.getString("result"), gest.name);
            
        }
        TGesture gest2 = new TGesture("T", "[[[478,41],[478,42],[478,43],[478,45],[478,46],[478,50],[479,54],[479,60],[479,67],[479,76],[479,85],[479,96],[479,106],[479,117],[478,127],[477,140],[477,151],[476,161],[475,170],[474,179],[473,186],[473,193],[472,199],[471,205],[470,210],[470,214],[468,219],[468,222],[468,225],[467,227],[467,229],[467,230],[467,231],[467,232],[467,233],[467,234],[467,235],[467,236],[467,237],[467,238],[467,239],[467,240],[467,241],[467,242],[467,243],[467,244],[467,245],[467,246],[467,247],[467,249],[467,252],[467,256],[467,259],[467,261],[467,264],[467,266],[467,268],[467,269],[467,271],[467,272],[467,273],[467,275],[467,276],[467,277],[467,278],[468,279],[468,280],[468,281],[468,282],[468,283],[468,284],[468,285],[468,286],[468,288],[469,289],[469,291],[469,292],[469,293],[469,294],[470,295],[470,296],[470,297],[470,298],[470,299],[470,300]],[[461,154],[460,154],[459,154],[458,154],[456,154],[453,154],[450,154],[447,154],[443,154],[439,154],[434,155],[429,155],[424,156],[418,156],[412,156],[406,157],[400,157],[395,157],[390,157],[386,157],[381,157],[377,157],[372,157],[368,157],[363,157],[359,157],[355,157],[350,157],[345,157],[341,157],[337,156],[333,156],[328,156],[325,156],[322,155],[318,155],[314,154],[311,154],[309,154],[306,154],[304,154],[302,153],[300,153],[298,153],[295,153],[293,153],[291,153],[289,152],[286,152],[284,152],[281,152],[278,152],[276,152],[274,152],[272,151],[269,151],[267,151],[264,151],[262,151],[261,151],[259,151],[258,151],[256,151],[255,151],[253,151],[251,151],[249,151],[247,151],[244,151],[241,151],[239,151],[237,152],[235,152],[233,152],[231,152],[229,152],[228,153],[226,153],[225,153],[223,153],[222,153],[221,153],[220,153],[218,153],[217,153],[215,153],[214,153],[212,153],[210,153],[208,153],[207,153],[205,153],[203,153],[202,153],[201,153],[200,153],[198,153],[197,153],[196,153],[195,153],[194,153],[193,153],[191,153],[190,153],[189,153],[179,152],[178,152],[177,152],[175,152],[174,151],[173,150],[171,150],[170,150],[169,150],[167,149],[166,149],[165,149],[163,149],[162,149],[161,149],[160,149],[159,149],[158,149],[157,149],[156,149],[155,149],[154,149],[153,149],[152,149],[151,149],[150,149],[149,149],[148,149],[147,149],[146,149],[145,149],[144,149],[143,149],[142,149],[141,149],[140,149],[139,149],[139,150]]]");
        object.put("name", gest2.name);
        object.put("points", gest2.points);
        response = clientAdmin.getResponse("/gesture/add", HttpMethod.POST, object);
        Assert.assertNotNull(response);
        Assert.assertEquals(response.getStatus(), WebServer.STATUS_DUPLICATE);
        response = clientAdmin.getResponse("/gesture/guess", HttpMethod.POST, gest2.points);
        Assert.assertNotNull(response);
        Assert.assertEquals(response.getStatus(), WebServer.STATUS_OK);
        JSONObject o = new JSONObject(response.getContentAsString());
        Assert.assertEquals(o.getString("result"), gest2.name);
        response = clientAdmin.getResponse("/gesture/list", HttpMethod.GET);
        Assert.assertNotNull(response);
        Assert.assertEquals(response.getStatus(), WebServer.STATUS_OK);
        arr = new JSONArray(response.getContentAsString());
        Assert.assertEquals(arr.length(), gests.length);
        for (TGesture gest : new TGesture[]{
                new TGesture("T", "[[[119,188],[119,189],[121,189],[123,189],[127,189],[132,190],[139,191],[147,192],[155,194],[164,196],[177,200],[189,203],[200,206],[212,209],[222,213],[233,216],[242,218],[253,221],[263,224],[272,226],[281,228],[290,230],[299,231],[306,232],[313,233],[320,234],[327,234],[333,235],[339,235],[344,236],[350,237],[355,237],[359,238],[364,239],[367,240],[371,240],[374,241],[377,242],[379,242],[382,243],[384,244],[387,245],[390,245],[392,245],[394,246],[396,246],[398,247],[399,247],[400,247],[400,248]],[[423,116],[423,124],[423,127],[421,133],[421,138],[419,146],[418,153],[416,163],[415,173],[413,186],[412,198],[410,210],[409,222],[407,233],[406,244],[404,254],[402,264],[401,272],[400,280],[399,286],[398,293],[397,298],[397,302],[397,306],[397,309],[396,312],[396,314],[396,316],[396,317],[396,318],[396,319],[396,320],[396,321],[396,322],[396,323]]]"),
                new TGesture("O", "[[[374,237],[375,237],[376,237],[377,237],[378,237],[378,236],[379,236],[381,235],[382,233],[384,231],[386,229],[389,226],[392,223],[394,219],[396,214],[399,209],[401,203],[404,196],[405,190],[406,183],[407,177],[408,170],[408,163],[408,157],[408,150],[408,144],[407,138],[406,131],[404,125],[402,119],[400,112],[398,107],[395,100],[392,94],[389,89],[386,84],[383,79],[379,75],[376,71],[372,66],[368,62],[365,59],[360,55],[357,52],[353,50],[348,47],[344,45],[340,43],[335,41],[330,39],[325,37],[320,37],[313,35],[308,35],[301,34],[296,34],[291,34],[285,34],[281,34],[276,34],[271,35],[267,37],[263,39],[259,41],[254,44],[250,46],[246,49],[243,52],[238,56],[235,60],[231,64],[228,68],[225,73],[221,79],[219,85],[216,90],[214,96],[212,101],[210,107],[209,112],[207,117],[206,122],[205,128],[204,132],[204,138],[203,143],[203,148],[203,152],[203,156],[203,160],[203,163],[205,167],[206,170],[207,172],[210,176],[212,180],[214,183],[217,187],[220,192],[224,196],[226,199],[229,202],[232,206],[235,209],[239,212],[242,214],[246,217],[250,219],[255,221],[260,223],[265,225],[271,227],[276,227],[281,228],[286,229],[292,230],[296,230],[301,230],[305,230],[310,231],[313,231],[317,231],[320,231],[324,231],[327,231],[331,231],[334,231],[336,231],[339,231],[341,231],[344,231],[346,231],[349,231],[351,231],[353,230],[356,229],[357,229],[359,229],[360,229],[362,228],[363,228],[364,228],[365,228],[366,228],[367,228],[368,228],[369,228],[369,227],[370,227],[371,227],[372,227],[373,227],[374,227],[375,227],[376,227],[377,227],[379,227],[380,227],[381,227],[383,227],[384,227],[385,227],[386,227]]]"),
                new TGesture("X", "[[[438,68],[438,69],[438,70],[438,71],[436,72],[433,74],[429,76],[425,78],[416,83],[407,87],[396,91],[384,96],[370,102],[356,107],[341,113],[328,117],[314,122],[302,125],[288,130],[276,135],[264,140],[252,144],[239,151],[227,157],[212,165],[200,172],[187,180],[175,188],[164,194],[151,201],[142,208],[134,213],[127,217],[120,221],[115,225],[110,228],[106,230],[102,232],[99,234],[97,236],[94,238],[91,239],[89,241],[87,242],[86,244],[84,244],[83,245],[84,245]],[[170,58],[171,58],[173,58],[175,59],[179,60],[183,61],[189,63],[196,65],[205,68],[216,72],[227,77],[242,82],[256,88],[270,95],[283,102],[296,109],[307,117],[318,125],[328,133],[338,140],[348,148],[356,155],[362,160],[370,168],[377,173],[383,178],[388,182],[394,186],[398,190],[402,193],[405,196],[408,199],[411,201],[413,203],[415,205],[416,206],[417,208],[419,209],[420,211],[421,212],[421,213],[423,214],[423,215],[424,216],[425,217],[425,218],[426,218],[426,219],[426,220],[427,220]]]"),
                new TGesture("sun", "[[[335,217],[335,216],[335,215],[335,214],[335,213],[335,212],[335,211],[335,210],[335,207],[335,206],[335,203],[336,201],[336,199],[337,197],[337,195],[337,193],[337,191],[337,189],[337,187],[337,185],[337,183],[336,181],[336,178],[335,177],[335,176],[334,174],[333,173],[333,172],[332,172],[331,171],[331,170],[330,169],[329,169],[328,168],[327,168],[326,167],[325,167],[323,165],[322,165],[321,164],[319,164],[317,164],[315,163],[312,163],[309,163],[307,163],[305,163],[302,163],[300,163],[298,163],[296,164],[295,164],[294,165],[292,167],[291,168],[290,169],[289,171],[289,172],[288,173],[287,175],[286,177],[286,179],[285,181],[285,183],[285,185],[285,187],[285,189],[285,192],[285,194],[285,196],[285,197],[285,199],[285,201],[286,203],[287,205],[288,207],[289,209],[289,210],[290,212],[291,213],[292,214],[293,215],[295,216],[296,217],[297,218],[298,219],[300,220],[301,221],[302,222],[304,223],[305,224],[307,225],[309,226],[310,226],[311,227],[312,228],[314,228],[315,229],[316,229],[317,229],[318,229],[319,229],[319,230],[320,230],[321,230],[322,230],[324,230],[325,230],[326,230],[327,230],[328,230],[329,230],[330,230],[330,229],[331,229],[332,229],[333,228],[333,227],[334,227],[334,226],[335,226],[335,225],[335,224],[336,223],[336,222],[336,221],[336,220],[336,219],[336,218],[336,216]],[[402,129],[399,129],[398,129],[397,129],[395,129],[393,129],[391,131],[389,132],[386,134],[383,136],[381,138],[378,140],[374,143],[371,146],[369,149],[365,153],[363,156],[361,158],[358,162],[357,165],[355,168],[353,171],[351,174],[350,176],[349,179],[348,182],[347,184],[346,186],[346,187],[346,188]],[[400,236],[399,236],[398,236],[397,236],[396,236],[396,235],[395,234],[393,233],[392,233],[391,232],[390,230],[388,229],[386,226],[383,224],[381,222],[379,219],[377,216],[374,213],[372,210],[370,209],[369,207],[367,204],[366,203],[365,202],[364,201],[363,201]],[[360,283],[360,282],[360,281],[359,281],[359,280],[358,278],[357,277],[356,274],[355,272],[354,269],[352,266],[351,263],[350,259],[348,255],[347,252],[345,248],[344,245],[343,242],[343,240],[342,238],[341,236],[341,235]],[[268,252],[268,251],[269,251],[269,250],[271,248],[272,247],[275,245],[277,242],[279,241],[281,238],[283,237],[285,235],[287,234],[289,232],[290,231],[292,230],[293,229],[295,227],[296,227],[297,226],[298,225],[299,225],[300,225],[300,224]],[[216,192],[217,191],[219,190],[221,190],[223,190],[226,189],[229,189],[232,189],[236,189],[240,189],[244,189],[247,189],[251,189],[255,189],[259,189],[263,189],[267,189],[270,189],[275,190],[279,190],[282,191],[284,191],[286,191],[287,191],[288,191],[289,191]],[[290,123],[290,124],[293,125],[295,128],[297,130],[299,132],[301,135],[304,137],[306,141],[309,144],[311,147],[313,150],[316,153],[317,156],[318,159],[320,162],[321,164],[322,167],[322,168],[323,170],[324,172],[324,173],[324,174],[324,175],[325,175],[325,176]]]"),
        }) {
            response = clientAdmin.getResponse("/gesture/guess", HttpMethod.POST, gest.points);
            Assert.assertNotNull(response);
            Assert.assertEquals(response.getStatus(), WebServer.STATUS_OK);
            o = new JSONObject(response.getContentAsString());
            Assert.assertEquals(o.getString("result"), gest.name);
            
        }
        
        response = clientAdmin.getResponse("/gesture/list", HttpMethod.GET);
        Assert.assertNotNull(response);
        Assert.assertEquals(response.getStatus(), WebServer.STATUS_OK);
        arr = new JSONArray(response.getContentAsString());
        Assert.assertEquals(arr.length(), gests.length);
        response = clientAdmin.getResponse("/gesture/delete", HttpMethod.DELETE, new JSONObject().put("id", arr.getJSONObject(0).getString("id")));
        Assert.assertNotNull(response);
        Assert.assertEquals(response.getStatus(), WebServer.STATUS_OK);
        arr = new JSONArray(response.getContentAsString());
        Assert.assertEquals(arr.length(), gests.length - 1);
        String randomKey = StringFunctions.generateRandomKey(32); //cant match our keys differ in size
        response = clientAdmin.getResponse("/gesture/delete", HttpMethod.DELETE, new JSONObject().put("id", randomKey));
        Assert.assertNotNull(response);
        Assert.assertEquals(response.getStatus(), WebServer.STATUS_NOT_FOUND);
        Assert.assertEquals(arr.length(), gests.length - 1);
        String newName = StringFunctions.generateRandomKey(26);
        boolean found = false;
        for (int i = 0; i < arr.length(); i++) {
            
            o = arr.getJSONObject(1);
            String name = o.getString("name");
            //search for all O gestures
            if (name.equals("O")) {
                String id = o.getString("id");
                //if this is the first occurence
                if (!found) {
                    //check if previous file exists
                    File f = controller.getGestureProvider().getGestureFile(name, id);
                    Assert.assertTrue(f.exists());
                    //actually rename it
                    response = clientAdmin.getResponse("/gesture/rename", HttpMethod.POST, new JSONObject().put("from", name).put("to", newName));
                    Assert.assertNotNull(response);
                    Assert.assertEquals(response.getStatus(), WebServer.STATUS_OK);
                    //check if the old file is gone
                    Assert.assertFalse(f.exists());
                    //check if the known good gesture will still be detected (with the new name!)
                    TGesture gest = new TGesture(newName, "[[[374,237],[375,237],[376,237],[377,237],[378,237],[378,236],[379,236],[381,235],[382,233],[384,231],[386,229],[389,226],[392,223],[394,219],[396,214],[399,209],[401,203],[404,196],[405,190],[406,183],[407,177],[408,170],[408,163],[408,157],[408,150],[408,144],[407,138],[406,131],[404,125],[402,119],[400,112],[398,107],[395,100],[392,94],[389,89],[386,84],[383,79],[379,75],[376,71],[372,66],[368,62],[365,59],[360,55],[357,52],[353,50],[348,47],[344,45],[340,43],[335,41],[330,39],[325,37],[320,37],[313,35],[308,35],[301,34],[296,34],[291,34],[285,34],[281,34],[276,34],[271,35],[267,37],[263,39],[259,41],[254,44],[250,46],[246,49],[243,52],[238,56],[235,60],[231,64],[228,68],[225,73],[221,79],[219,85],[216,90],[214,96],[212,101],[210,107],[209,112],[207,117],[206,122],[205,128],[204,132],[204,138],[203,143],[203,148],[203,152],[203,156],[203,160],[203,163],[205,167],[206,170],[207,172],[210,176],[212,180],[214,183],[217,187],[220,192],[224,196],[226,199],[229,202],[232,206],[235,209],[239,212],[242,214],[246,217],[250,219],[255,221],[260,223],[265,225],[271,227],[276,227],[281,228],[286,229],[292,230],[296,230],[301,230],[305,230],[310,231],[313,231],[317,231],[320,231],[324,231],[327,231],[331,231],[334,231],[336,231],[339,231],[341,231],[344,231],[346,231],[349,231],[351,231],[353,230],[356,229],[357,229],[359,229],[360,229],[362,228],[363,228],[364,228],[365,228],[366,228],[367,228],[368,228],[369,228],[369,227],[370,227],[371,227],[372,227],[373,227],[374,227],[375,227],[376,227],[377,227],[379,227],[380,227],[381,227],[383,227],[384,227],[385,227],[386,227]]]");
                    response = clientAdmin.getResponse("/gesture/guess", HttpMethod.POST, gest.points);
                    Assert.assertNotNull(response);
                    Assert.assertEquals(response.getStatus(), WebServer.STATUS_OK);
                    JSONObject o2 = new JSONObject(response.getContentAsString());
                    
                    Assert.assertEquals(o2.getString("result"), newName);
                    found = true;
                }
                //check if its saved under its new name
                File f2 = controller.getGestureProvider().getGestureFile(newName, id);
                Assert.assertTrue(f2.exists());
                
            }
        }
        Assert.assertTrue(found);
        
    }
    
    @Test(groups = "testGesture2", dependsOnGroups = {"testGesture"})
    public void testGesture2() {
    
    }
    
    private static class TGesture {
        final String name;
        final JSONArray points;
        
        public TGesture(String name, JSONArray points) {
            this.name = name;
            this.points = points;
        }
        
        public TGesture(String name, String points) {
            this(name, new JSONArray(points));
        }
    }
    
}
